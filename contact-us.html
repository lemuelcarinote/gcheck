<div class="pipedriveWebForms" data-pd-webforms="https://webforms.pipedrive.com/f/6iLCWNNfhyJvYlr6NCZRtivXjv87G7BHpuiLwbM01q8fVqpsMil5QomqaYakvEYVbB">
    <script src="https://webforms.pipedrive.com/f/loader"></script>
</div>

<script>
    console.log("script init.");

    // Initialize dataLayer if not already defined
    window.dataLayer = window.dataLayer || [];

    // Function to push to dataLayer
    function pushToDataLayer(eventName, additionalData = {}) {
        console.log(eventName);
        window.dataLayer.push({
            event: eventName,
            ...additionalData
        });
    }

    // Intercept network requests
    const originalFetch = window.fetch;
    window.fetch = function(...args) {
        const url = args[0];

        console.log("URLs: ", url);

        // Call the original fetch function
        return originalFetch.apply(this, args).then(response => {
            // Check if the request URL indicates a form viewed
            if (url.includes("/viewed")) {
                console.log("You are viewing a pipedrive webform");
                pushToDataLayer('contact_us_viewed', {
                   formUrl: url
                });
            }

            // Check if the request URL indicates a form interacted
            if (url.includes("/interacted")) {
                console.log("You interacted on a pipedrive webform");
                pushToDataLayer('contact_us_interacted', {
                    formUrl: url
                });
            }

            // Check if the request URL indicates form submission
            if (url.includes("/f/6iLCWNNfhyJvYlr6NCZRtivXjv87G7BHpuiLwbM01q8fVqpsMil5QomqaYakvEYVbB") && response.ok) {
                // Assuming the form submission data is in the request body
                return response.clone().json().then(data => {
                    console.log("You submitted on a pipedrive webform");
                    pushToDataLayer('contact_us_formsubmitted', {
                        formData: data
                    });
                }).catch(error => {
                    console.error("Error parsing submission data:", error);
                });
            }

            return response;
        });
    };
</script>
